jQuery(document).ready(function(n){function l(e,a){var t=null,i="";return null!==(t="image"==a?e.attr("id").match(/wmu\-\d+\_\d+\-image\-(\d+)/):"video"==a?e.attr("id").match(/wmu\-\d+\_\d+\-video\-(\d+)/):e.attr("id").match(/wmu\-\d+\_\d+\-file\-(\d+)/))&&(i=t[1]),i}function t(){1==wpdiscuzAjaxObj.wpdiscuz_options.wmuIsLightbox&&n(".wmu-attached-image-link").colorbox({maxHeight:"95%",maxWidth:"95%",rel:"wmu-attached-image-link"})}if(n(".wmu_reset").val(""),t(),n(document).delegate(".wmu-multiple","click",function(){var e=n(this).children(".wmu-type").val(),a=n(this).parents(".wpdiscuz-textarea-foot"),t=n(".wmu-"+e+"-tab",a);n(".wmu-tabs:not('.wmu-"+e+"-tab')",a).removeClass("wmu-show"),t.toggleClass("wmu-show"),n(".wmu-multiple.wmu-active").removeClass("wmu-active"),n(this).toggleClass("wmu-active"),t.is(":visible")||n(this).removeClass("wmu-active")}),n(document).delegate(".wmu-image","change",function(){var e=n(this),a=l(e,"image"),t=e.parents(".wc_comm_form"),i=n(".wmu-preview-image-"+a,t),m=n("img",i),s=e[0].files?e[0].files:[],u=s[0].name;if(s.length)if(e.parents(".wmu-add-"+a,".wmu-tabs").removeClass("wmu-show"),i.addClass("wmu-show"),i.attr("title",u),window.FileReader){var w=new FileReader;w.readAsDataURL(s[0]),w.onloadend=function(){n(m).attr("src",this.result)}}else n(m).replaceWith('<div class="wmu-filreader-not-exist">'+s[0].name+"</div>")}),n(document).delegate(".wmu-video","change",function(){var e=n(this),a=l(e,"video"),t=e.parents(".wc_comm_form"),i=n(".wmu-preview-video-"+a,t),m=n(".wmu-preview-video-"+a+" .wmu-preview-remove .wmu-file-name",t),s=n("img",i),u=e[0].files?e[0].files:[],w=u[0].name;u.length&&(n(s).attr("src",wpdiscuzAjaxObj.wpdiscuz_options.iconVideoAudio),e.parents(".wmu-add-"+a,".wmu-tabs").removeClass("wmu-show"),i.addClass("wmu-show"),i.attr("title",w),30<w.length&&(w="..."+w.slice(-30)),m.html(w))}),n(document).delegate(".wmu-file","change",function(){var e=n(this),a=l(e,"file"),t=e.parents(".wc_comm_form"),i=n(".wmu-preview-file-"+a,t),m=n(".wmu-preview-file-"+a+" .wmu-preview-remove .wmu-file-name",t),s=n("img",i),u=wpdiscuzAjaxObj.wpdiscuz_options.iconFile,w=e[0].files?e[0].files:[],o=w[0].name;w.length&&(e.parents(".wmu-add-"+a,".wmu-tabs").removeClass("wmu-show"),i.addClass("wmu-show"),i.attr("title",w[0].name),s.attr("src",u),30<o.length&&(o="..."+o.slice(-30)),m.html(o))}),n(document).delegate(".wmu-attachment-delete","click",function(e){if(confirm(wpdiscuzAjaxObj.wpdiscuz_options.confirmDelete)){n(".wpdiscuz-loading-bar").show();var a=new FormData,t=n(this),i=function(e){var a=e.attr("id").match(/wmu\-attach\-remove\-(\d+)/),t=0;null!==a&&(t=a[1]);return t}(t),m=t.parents(".wc-comment-right").attr("id"),s=m.substring(m.lastIndexOf("-")+1),u="";u=t.hasClass("wmu-delete-image")?"image":t.hasClass("wmu-delete-video")?"video":"file",0<i?(a.append("action","removeAttachment"),a.append("commentId",s),a.append("attachmentId",i),a.append("metaKey",u),n.ajax({type:"POST",url:wpdiscuzAjaxObj.url,data:a,contentType:!1,processData:!1}).done(function(e){try{var a=n.parseJSON(e);null!=a&&""!=a&&0<a.id&&n(".wmu-attachment-"+a.id).remove()}catch(e){console.log(e)}n(".wpdiscuz-loading-bar").hide()})):console.log("Cannot get attachment id")}else console.log("canceled")}),n(document).delegate(".wmu-preview","click",function(){var e=n(this),a=n(e).parents(".wmu-tabs"),t="",i=function(e,a){var t=null,i="";t="image"==a?e.attr("class").match(/wmu\-preview\-image\-(\d+)/):"video"==a?e.attr("class").match(/wmu\-preview\-video\-(\d+)/):e.attr("class").match(/wmu\-preview\-file\-(\d+)/);null!==t&&(i=t[1]);return i}(e,t=n(e).hasClass("wmu-preview-image")?"image":n(e).hasClass("wmu-preview-video")?"video":"file"),m=n(".wmu-add-"+i+" #wmu-"+t+"-"+i,a);n("img",e).attr("src",""),n(e).removeClass("wmu-show"),n(".wmu-add-"+i,a).addClass("wmu-show"),n(m).replaceWith('<input id="wmu-'+t+"-"+i+'" class="wmu-'+t+'" type="file" name="wmu_'+t+'[]"/>')}),wpdiscuzAjaxObj.wmuAddLightBox=function(){1==wpdiscuzAjaxObj.wpdiscuz_options.wmuIsLightbox&&n(".wmu-attached-image-link").colorbox({maxHeight:"95%",maxWidth:"95%",rel:"wmu-attached-image-link"})},wpdiscuzAjaxObj.wmuHideAll=function(e,a){0<=parseInt(e)?(n(".wmu-tabs",a).removeClass("wmu-show"),n(".wmu-preview",a).removeClass("wmu-show"),n(".wmu-preview img",a).attr("src",""),n.each(n(".wmu-add",a),function(){n(this).hasClass("wmu-show")||n(this).addClass("wmu-show")}),n(".wmu_reset",a).val(""),n(".wmu-multiple",a).removeClass("wmu-active"),t()):console.log("error occured while posting comment")},wmuFrontJsObj.wmuLazyLoadImages&&(wpdiscuzAjaxObj.wmuImagesInit=function(){for(var e=n("img"),a=0;a<e.length;a++){var t=n(e[a]),i=t.attr("wmu-data-src");i&&t.attr("src",i)}}),wmuFrontJsObj.wmuLazyLoadImages){!function(){for(var e=n("img"),a=0;a<e.length;a++){var t=n(e[a]),i=t.attr("wmu-data-src");i&&t.attr("src",i)}}()}});